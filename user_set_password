---
- name: check if password file exists
    stat: 
    path: "/opt/pmaker/dev/{{ item.item.username }}/.ssh/secret.txt"
    with_items: '{{ users }}'
    register: password_created

- name: Generate Passwords
    become: no
    local_action: command pwgen --symbols --numerals --capitalize --ambiguous 12
    when: password_created
    with_items: '{{ user_passwords.results }}'
    register: user_passwords

- name: Save Passwords Locally
    become: no
    local_action: copy content={{ item.stdout }} dest="/opt/pmaker/dev/{{ item.item.username }}/.ssh/secret.txt"
    with_items: '{{ user_passwords.results }}'
