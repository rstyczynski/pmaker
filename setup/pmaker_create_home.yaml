---
- name: Create master pmaker 
  become: yes
  user:
    name: "{{ item.username }}"

- name: generate SSH key "{{ item.username }}"
  openssh_keypair:
    path: "{{ pmaker_home }}/.ssh/id_rsa"
    type: rsa
    size: 2048
    state: present
    force: no

# - name: create pmaker directory
#   become: yes
#   file:
#     path: /opt/{{ item.username }}/.ssh
#     state: directory
#     owner: "{{ item.username }}"
#     mode: u+r,g-w+x,o+x
#     recurse: yes

# - name: copy pmaker key to pmaker_home directory
#   become: yes
#   copy:
#     src: "/home/{{ item.username }}/.ssh/id_rsa.pub"
#     dest: /opt/{{ item.username }}/.ssh
#     remote_src: yes

# - name: make key private
#   become: yes
#   file:
#     path: /opt/{{ item.username }}/.ssh/id_rsa.pub
#     state: file
#     owner: "{{ item.username }}"
#     group: "{{ item.username }}"
#     mode: u+r,g-w+r,o+r
