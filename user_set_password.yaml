---
- name: Check if password file exists i.e. password already generated
  stat: 
    path: "/home/{{ item.username }}/.ssh/secret.txt"
  register: password_created

- name: Update User Password
  user:
    name: '{{ item.item }}'
    password: "{{ lookup('file', '/opt/pmaker/{{ server_group }}/{{ item.username }}/.ssh/secret.txt') }}"
  when: password_created.stat.exists == False

- local_action: copy content={{ foo_result }} dest="/home/{{ item.username }}/.ssh/secret.txt"
  when: password_created.stat.exists == False
